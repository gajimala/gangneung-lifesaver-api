<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>인명구조함 지도 (네이버)</title>
  <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=y6akfogygp"></script>
  <style>
    html, body, #map {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    const map = new naver.maps.Map('map', {
      center: new naver.maps.LatLng(37.75, 128.9),
      zoom: 11
    });

    let markers = [];

    // 마커 생성 함수
    function createMarker(data) {
      return new naver.maps.Marker({
        position: new naver.maps.LatLng(data.lat, data.lon),
        map: null, // 일단 지도에 올리지 않음
        icon: {
          url: "./img/pin_default.png", // 커스텀 마커 이미지
          size: new naver.maps.Size(25, 34),
          anchor: new naver.maps.Point(12, 34),
          scaledSize: new naver.maps.Size(25, 34)
        },
        title: data.name || "인명구조함",
        animation: naver.maps.Animation.DROP
      });
    }

    // 현재 화면 영역 내 마커만 표시
    function updateVisibleMarkers() {
      const bounds = map.getBounds();
      markers.forEach(marker => {
        const pos = marker.getPosition();
        if (bounds.hasLatLng(pos)) {
          marker.setMap(map);
        } else {
          marker.setMap(null);
        }
      });
    }

    // API 데이터 받아서 마커 초기화
    fetch("https://gangneung-lifesaver-api-vcj2.onrender.com/lifesavers")
      .then(res => res.json())
      .then(data => {
        markers = data.map(item => createMarker(item));
        updateVisibleMarkers();
      });

    // 지도 이벤트 바인딩
    naver.maps.Event.addListener(map, "dragend", updateVisibleMarkers);
    naver.maps.Event.addListener(map, "zoom_changed", updateVisibleMarkers);
  </script>
</body>
</html>
